#!/usr/bin/perl
use strict;
use warnings;
$|++;

my $restart = 0;
$SIG{USR1} = sub {
	$restart = 1;
};

while (<>) {
	chomp;
	my ($ws, $layout, $title) = split(/\s:\s/, $_, 3);
	$layout =~ s/Maximize //g;
	$layout =~ s/Hinted //g;
	$layout =~ s/Dishes \d \(\d+%\d+\) ?/Dishes/g;
	$layout ||= 'layout';
	$title ||= '';

    my @ws;
	foreach (split(/ +/, $ws)) {
	    if (/^\[(.+)\]$/) {
	        push @ws, "^fg(red)[^fg(yellow)$1^fg(red)]^fg()";
	    } else {
	        push @ws, " $_ ";
	    }
	}

	$ws = join('', @ws);
	$layout = ucfirst $layout;

	print "$ws ^fg(SteelBlue3)($layout)^fg() ^fg(white)$title^fg()\n";

	if ($restart) {
		exec($0);
	}
}
