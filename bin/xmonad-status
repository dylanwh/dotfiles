#!/usr/bin/perl
use strict;
use warnings;
$|++;

my $restart = 0;
$SIG{USR1} = sub {
	$restart = 1;
};

while (<>) {
	chomp;
	my ($ws, $layout, $title) = split(/\s:\s/, $_, 3);
	$layout =~ s/Maximize //g;
	$layout =~ s/Hinted //g;
	$layout =~ s/Dishes \d \(\d+%\d+\) ?/Dishes/g;
	$layout ||= 'layout';
	$title ||= '';

    my @ws;
	foreach (split(/ +/, $ws)) {
	    if (/^\[(.+)\]$/) {
	        push @ws, "<fc=red>[</fc><fc=yellow>$1</fc><fc=red>]</fc>";
	    } else {
	        push @ws, " $_ ";
	    }
	}

	$ws = join('', @ws);
	$layout = ucfirst $layout;

	print "$ws <fc=SteelBlue3>($layout)</fc> <fc=white>$title</fc>\n";

	if ($restart) {
		exec($0);
	}
}
