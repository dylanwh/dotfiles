#!/usr/bin/env perl
use strict;
use warnings;
use File::Basename;
use Getopt::Long qw( :config gnu_getopt );

my $TERM  = 'urxvt';
my ($title, $name, $eep, $chdir );

foreach (@ARGV) {
    if ($_ eq '-e') {
        $_ = '--';
        last 
    }
    elsif (/^-name/) {
        $_ = '--name';
    }
    elsif (/^-([rd]+)e$/ or /^-e(.+)$/) {
        unshift @ARGV, "-$1" if $1;
        $_ = '--';
        last;
    } 
}

GetOptions(
    'title|t=s' => \$title,
    'name|n=s'  => \$name,
    'e'         => \$eep,
    'chdir|C=s' => \$chdir,
);

my (@run) = @ARGV;

if (@run) {
    $title //= "$run[0]: @run[1..$#run]";
}

unless ($name) {
    if (-e "$ENV{HOME}/.outside") {
        $name = 'outside';
    }
    else {
        $name = $run[0];
    }
}

chdir $chdir if $chdir;

unshift @run, '-e' if @run;

exec($TERM,
    $chdir ? () : ('-ls'),
    -name  => $name,
    -title => $title,
    @run
);
