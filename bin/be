#!/bin/zsh

if [[ -z $1 ]]; then
	echo "usage: be cmd [args...]" >&2
	exit 1
fi

tmp=${TMPDIR:-/tmp}
dir=${BE_DIR:-"$tmp/be"}
cmd=$1; shift
cmdfile=$(which $cmd)
base=$(basename $cmdfile)
pidfile="$dir/$LOGNAME-$base.pid"

args=(
	--make-pidfile
	--pidfile $pidfile
	--retry 5
	--name $base
)

mkdir -p $dir

#set -x
start-stop-daemon $args -K
start-stop-daemon --background $args --startas $cmdfile -S -- "$@"
