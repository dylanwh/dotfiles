#!/bin/zsh

if [[ -z $1 ]]; then
	echo "usage: be cmd [args...]" >&2
	exit 1
fi

tmp=${TMPDIR:-/tmp}
dir=${BE_DIR:-"$tmp/be"}
cmd=$1; shift
cmdfile=$(which $cmd)
base=$(basename $cmdfile)
pidfile="$dir/$LOGNAME-$base.pid"

args=(
	--make-pidfile
	--pidfile $pidfile
	--retry 2
	--name $base
)

mkdir -p $dir

start-stop-daemon $args -K
echo $?
start-stop-daemon --background --startas $cmdfile $args -S
echo $?
