#!/usr/bin/make -f

SHELL  = bash
TMPDIR ?= /tmp
DIR    = $(TMPDIR)/dylan-home

$(HOME)/home.tar.gz: $(DIR)
	tar -C $< -zcf $@ .
	rm -rf $(DIR)

$(DIR): $(HOME)
	@mkdir -vp $(DIR)
	@echo "cloning $<..."
	@git clone --recursive $< $@
	@cd $(DIR) && ( \
		git remote rm origin; \
		git remote add origin git@git.hardison.net:dylan/home; \
		git remote add github git@github.com:dylanwh/dylan.git; \
	)

# 
# cd ${TMPDIR:-/tmp}             || exit 1
# git clone $HOME home           || exit 1
# cd home                        
# git submodule init
# git submodule update
# tar -C home -zcf home.tar.gz . || exit 1
# rm -fr home                   || exit 1
# mv -v home.tar.gz $HOME/Dropbox/Public       || exit 1
