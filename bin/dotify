#!/usr/bin/env perl
use strict;
use warnings;
use IO::Dir;
use Sys::Hostname;
chdir($ENV{HOME});

my $host = hostname();
my $dir = IO::Dir->new('priv') or die "Can't open ~/priv: $!";
my @files = grep !/^\.\.?$/, grep !/_darcs/, readdir $dir;

foreach my $file (@files) {
    if ($file =~ /^(.+?)@(\w+)$/ and $2 eq $host) {
        print "priv/$file -> .$1\n";
        symlink("$ENV{HOME}/priv/$file", "$ENV{HOME}/.$1");
    } elsif (index($file, '@') != -1) {
        print "Ignoring $file\n";
    } else {
        print "priv/$file -> .$file\n";
        symlink("$ENV{HOME}/priv/$file", "$ENV{HOME}/.$file");
    }
}
