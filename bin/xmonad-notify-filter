#!/usr/bin/env perl
use v5.10;
use strict;
use warnings;
use JSON 'decode_json';
use Time::HiRes 'time';
$|++;

while (my $msg = <STDIN>) {
    my $note = decode_json($msg);
    my $time = $note->{timestamp};
    my $next = $time + $note->{expire}/1000;
    my $now  = time;
    if ($now < $next ) {
        say "^tw()$note->{summary}\n^cs()";
        say "$note->{body}" if $note->{body};
        sleep ($next - $time);
    }
}
